CREATE DATABASE THUCTAPP1
GO

USE THUCTAPP1
GO

CREATE TABLE KHOA(
	MAKHOA CHAR(10) PRIMARY KEY,
	TENKHOA CHAR(30) NOT NULL,
	DIENTHOAI CHAR(10) NOT NULL
)
GO

CREATE TABLE GIANGVIEN(
	MAGV INT PRIMARY KEY,
	HOTENGV CHAR(30) NOT NULL,
	LUONG DECIMAL(5,2) NOT NULL,
	MAKHOA CHAR(10) FOREIGN KEY(MAKHOA) REFERENCES KHOA(MAKHOA) ON UPDATE CASCADE ON DELETE CASCADE
)
GO

CREATE TABLE SINHVIEN(
	MASV INT PRIMARY KEY,
	HOTENSV CHAR(30) NOT NULL,
	MAKHOA CHAR(10) FOREIGN KEY(MAKHOA) REFERENCES KHOA(MAKHOA) ON UPDATE CASCADE ON DELETE CASCADE,
	NAMSINH INT,
	QUEQUAN CHAR(30)
)
GO

CREATE TABLE DETAI(
	MADT CHAR(10) PRIMARY KEY,
	TENDT CHAR(30) NOT NULL,
	KINHPHI INT NOT NULL,
	NOITHUCTAP CHAR(30) NOT NULL
)
GO

CREATE TABLE HUONGDAN(
	MASV INT PRIMARY KEY,
	MADT CHAR(10) FOREIGN KEY(MADT) REFERENCES DETAI(MADT) ON UPDATE CASCADE ON DELETE CASCADE,
	MAGV INT FOREIGN KEY(MAGV) REFERENCES GIANGVIEN(MAGV) ON UPDATE CASCADE ON DELETE CASCADE,
	KETQUA DECIMAL(5,2)
)
GO

INSERT INTO KHOA VALUES
	('Geo','Dia ly va QLTN',3855413),
	('Math','Toan',3855411),
	('Bio','Cong nghe Sinh hoc',3855412);

INSERT INTO GIANGVIEN VALUES
	(11,'Thanh Binh',700,'Geo'),    
	(12,'Thu Huong',500,'Math'),
	(13,'Chu Vinh',650,'Geo'),
	(14,'Le Thi Ly',500,'Bio'),
	(15,'Tran Son',900,'Math');

INSERT INTO SINHVIEN VALUES
	('1','Le Van Son','Bio',1990,'Nghe An'),
	('2','Nguyen Thi Mai','Geo',1990,'Thanh Hoa'),
	('3','Bui Xuan Duc','Math',1992,'Ha Noi'),
	('4','Nguyen Van Tung','Bio',null,'Ha Tinh'),
	('5','Le Khanh Linh','Bio',1989,'Ha Nam'),
	('6','Tran Khac Trong','Geo',1991,'Thanh Hoa'),
	('7','Le Thi Van','Math',null,'null'),
	('8','Hoang Van Duc','Bio',1992,'Nghe An');

INSERT INTO DETAI VALUES
	('Dt01','GIS',100,'Nghe An'),
	('Dt02','ARC GIS',500,'Nam Dinh'),
	('Dt03','Spatial DB',100, 'Ha Tinh'),
	('Dt04','MAP',300,'Quang Binh' );

INSERT INTO HUONGDAN VALUES
	(1,'Dt01',13,8),
	(2,'Dt03',14,0),
	(3,'Dt03',12,10),
	(5,'Dt04',14,7),
	(6,'Dt01',13,Null),
	(7,'Dt04',11,10),
	(8,'Dt03',15,6);

SELECT MAGV, HOTENGV, TENKHOA
		FROM GIANGVIEN JOIN KHOA ON GIANGVIEN.MAKHOA=KHOA.MAKHOA

SELECT MAGV, HOTENGV, TENKHOA
		FROM GIANGVIEN JOIN KHOA ON GIANGVIEN.MAKHOA=KHOA.MAKHOA
		WHERE TENKHOA='DIA LY' AND TENKHOA='QLTN'

SELECT COUNT(SINHVIEN.MASV) AS SOSV
		FROM SINHVIEN
		WHERE MAKHOA='Bio'

SELECT MASV, HOTENSV, NAMSINH, TENKHOA
		FROM SINHVIEN JOIN KHOA ON SINHVIEN.MAKHOA=KHOA.MAKHOA
		WHERE TENKHOA='TOAN'

SELECT COUNT(GIANGVIEN.MAGV) AS SOGV
		FROM GIANGVIEN JOIN KHOA ON GIANGVIEN.MAKHOA=KHOA.MAKHOA
		WHERE TENKHOA='CONG NGHE SINH HOC'

SELECT* FROM SINHVIEN
		WHERE NOT EXISTS (SELECT HUONGDAN.MASV FROM HUONGDAN WHERE SINHVIEN.MASV=HUONGDAN.MASV)

SELECT KHOA.MAKHOA,KHOA.TENKHOA, COUNT(KHOA.MAKHOA) AS SOGV
		FROM GIANGVIEN  JOIN KHOA
		ON GIANGVIEN.MAKHOA = KHOA.MAKHOA
		GROUP BY KHOA.MAKHOA,KHOA.TENKHOA

SELECT KHOA.DIENTHOAI
		FROM KHOA JOIN SINHVIEN
		ON KHOA.MAKHOA = SINHVIEN.MAKHOA
		WHERE SINHVIEN.HOTENSV = 'Le Van Son'





